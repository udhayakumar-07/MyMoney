<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money Tracker Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .currency-selector {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .currency-selector label {
            margin-right: 10px;
            font-weight: 600;
        }
        
        .currency-selector select {
            padding: 8px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .stat-card h3 {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .stat-card .amount {
            font-size: 2em;
            font-weight: bold;
        }
        
        .income { color: #10b981; }
        .expense { color: #ef4444; }
        .fuel { color: #f59e0b; }
        .balance { color: #3b82f6; }
        
        .balance-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .balance-card.negative {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .balance-card h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .balance-card .amount {
            font-size: 3em;
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        
        .btn-add:hover {
            transform: scale(1.05);
        }
        
        .btn-export {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-export:hover {
            background: #667eea;
            color: white;
        }
        
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .form-container.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .custom-category-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .custom-category-section.active {
            display: block;
        }
        
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .icon-option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 2em;
            transition: all 0.2s;
        }
        
        .icon-option:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }
        
        .icon-option.selected {
            border-color: #667eea;
            background: #667eea;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-primary {
            background: #10b981;
            color: white;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #333;
        }
        
        .time-filter-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .time-filters {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .time-filter-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            background: #f3f4f6;
            color: #333;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .time-filter-btn.active {
            background: #667eea;
            color: white;
        }
        
        .type-filters {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            background: white;
            color: #333;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .transactions-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .transactions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .transactions-container h2 {
            color: #333;
        }
        
        .transaction {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid;
        }
        
        .transaction.income-type { border-color: #10b981; }
        .transaction.expense-type { border-color: #ef4444; }
        .transaction.fuel-type { border-color: #f59e0b; }
        
        .transaction-info h4 {
            margin-bottom: 5px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .transaction-icon {
            font-size: 1.5em;
        }
        
        .transaction-details {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            flex-wrap: wrap;
        }
        
        .transaction-amount {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .transaction-amount .amount {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .btn-delete {
            background: #fee2e2;
            color: #ef4444;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .btn-delete:hover {
            background: #fecaca;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
            margin-right: 10px;
        }
        
        .export-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .export-menu {
            display: none;
            position: absolute;
            background: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-radius: 8px;
            min-width: 150px;
            z-index: 1000;
            top: 100%;
            right: 0;
            margin-top: 5px;
        }
        
        .export-menu.active {
            display: block;
        }
        
        .export-menu button {
            width: 100%;
            padding: 12px 20px;
            border: none;
            background: white;
            text-align: left;
            cursor: pointer;
            font-weight: 600;
            color: #333;
            transition: background 0.2s;
        }
        
        .export-menu button:hover {
            background: #f3f4f6;
        }
        
        .export-menu button:first-child {
            border-radius: 8px 8px 0 0;
        }
        
        .export-menu button:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .transaction {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .transaction-amount {
                width: 100%;
                justify-content: space-between;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-add, .btn-export {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Money Tracker Pro</h1>
            <p>Track your income, expenses, fuel, and mileage</p>
            <div class="currency-selector">
                <label>Currency:</label>
                <select id="currencySelect" onchange="changeCurrency()">
                    <option value="USD" data-symbol="$">USD ($)</option>
                    <option value="EUR" data-symbol="‚Ç¨">EUR (‚Ç¨)</option>
                    <option value="GBP" data-symbol="¬£">GBP (¬£)</option>
                    <option value="JPY" data-symbol="¬•">JPY (¬•)</option>
                    <option value="CNY" data-symbol="¬•">CNY (¬•)</option>
                    <option value="INR" data-symbol="‚Çπ">INR (‚Çπ)</option>
                    <option value="AUD" data-symbol="A$">AUD (A$)</option>
                    <option value="CAD" data-symbol="C$">CAD (C$)</option>
                    <option value="CHF" data-symbol="CHF">CHF (CHF)</option>
                    <option value="AED" data-symbol="AED">AED (AED)</option>
                    <option value="SAR" data-symbol="SAR">SAR (SAR)</option>
                    <option value="BRL" data-symbol="R$">BRL (R$)</option>
                    <option value="MXN" data-symbol="MX$">MXN (MX$)</option>
                    <option value="KRW" data-symbol="‚Ç©">KRW (‚Ç©)</option>
                    <option value="SGD" data-symbol="S$">SGD (S$)</option>
                    <option value="ZAR" data-symbol="R">ZAR (R)</option>
                </select>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Income</h3>
                <div class="amount income" id="totalIncome">$0.00</div>
            </div>
            <div class="stat-card">
                <h3>Total Expenses</h3>
                <div class="amount expense" id="totalExpense">$0.00</div>
            </div>
            <div class="stat-card">
                <h3>Fuel Spent</h3>
                <div class="amount fuel" id="totalFuel">$0.00</div>
            </div>
            <div class="stat-card">
                <h3>Total Mileage</h3>
                <div class="amount balance" id="totalMileage">0.0 mi</div>
            </div>
        </div>
        
        <div class="balance-card" id="balanceCard">
            <h2>Current Balance</h2>
            <div class="amount" id="balance">$0.00</div>
        </div>
        
        <div class="action-buttons">
            <button class="btn-add" onclick="toggleForm()">‚ûï Add Transaction</button>
            <div class="export-dropdown">
                <button class="btn-export" onclick="toggleExportMenu()">üì• Export Data</button>
                <div class="export-menu" id="exportMenu">
                    <button onclick="exportCSV()">Export as CSV</button>
                    <button onclick="exportExcel()">Export as Excel</button>
                    <button onclick="exportJSON()">Export as JSON</button>
                </div>
            </div>
        </div>
        
        <div class="form-container" id="formContainer">
            <h2>New Transaction</h2>
            <form id="transactionForm" onsubmit="addTransaction(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Type</label>
                        <select id="type" onchange="updateCategories()">
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                            <option value="fuel">Fuel</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Category</label>
                        <select id="category" onchange="checkCustomCategory()"></select>
                    </div>
                    
                    <div class="form-group">
                        <label>Amount</label>
                        <input type="number" id="amount" step="0.01" required placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="date" required>
                    </div>
                </div>
                
                <div class="custom-category-section" id="customCategorySection">
                    <div class="form-group">
                        <label>Custom Category Name</label>
                        <input type="text" id="customCategoryName" placeholder="e.g., Pet Care, Subscriptions">
                    </div>
                    
                    <div class="form-group">
                        <label>Choose Icon</label>
                        <div class="icon-selector" id="iconSelector"></div>
                        <input type="hidden" id="selectedIcon">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="description" placeholder="e.g., Groceries, Salary, Gas station">
                </div>
                
                <div class="form-grid" id="fuelFields" style="display: none;">
                    <div class="form-group">
                        <label>Mileage (mi)</label>
                        <input type="number" id="mileage" step="0.1" placeholder="0.0">
                    </div>
                    
                    <div class="form-group">
                        <label>Fuel Amount (gal)</label>
                        <input type="number" id="fuelAmount" step="0.01" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="notes" rows="3" placeholder="Add any additional notes..."></textarea>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Add Transaction</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleForm()">Cancel</button>
                </div>
            </form>
        </div>
        
        <div class="time-filter-section">
            <div class="time-filters">
                <button class="time-filter-btn" onclick="filterByTime('today')">Today</button>
                <button class="time-filter-btn" onclick="filterByTime('yesterday')">Yesterday</button>
                <button class="time-filter-btn" onclick="filterByTime('week')">This Week</button>
                <button class="time-filter-btn" onclick="filterByTime('month')">This Month</button>
                <button class="time-filter-btn" onclick="filterByTime('year')">This Year</button>
                <button class="time-filter-btn active" onclick="filterByTime('all')">All Time</button>
            </div>
            
            <div class="type-filters">
                <button class="filter-btn active" onclick="filterTransactions('all')">All</button>
                <button class="filter-btn" onclick="filterTransactions('income')">Income</button>
                <button class="filter-btn" onclick="filterTransactions('expense')">Expenses</button>
                <button class="filter-btn" onclick="filterTransactions('fuel')">Fuel</button>
            </div>
        </div>
        
        <div class="transactions-container">
            <div class="transactions-header">
                <h2>Transaction History</h2>
                <div id="transactionCount" style="color: #666; font-weight: 600;"></div>
            </div>
            <div id="transactionsList">
                <div class="empty-state">No transactions yet. Add your first one!</div>
            </div>
        </div>
    </div>

    <script>
        // Available icons for custom categories
        const availableIcons = [
            'üè†', 'üè•', 'üéì', 'üçî', 'üöó', '‚úàÔ∏è', 'üé¨', 'üéÆ', 'üéµ', 'üì±', 
            'üíª', 'üìö', 'üõí', 'üëï', 'üëü', 'üíä', 'üêï', 'üê±', 'üåø', 'üèãÔ∏è',
            '‚öΩ', 'üé®', 'üé™', 'üé≠', 'üì∏', 'üé§', 'üé∏', 'üéπ', 'üéØ', 'üé≤',
            '‚òï', 'üçï', 'üçú', 'üç∞', 'üç∫', 'üíº', 'üëî', 'üíÑ', 'üíç', 'üéÅ',
            'üì¶', 'üîß', 'üî®', 'üè°', 'üå≥', 'üíê', 'üö≤', 'üèçÔ∏è', 'üõ¥', 'üöÅ'
        ];
        
        const defaultCategories = {
            income: [
                {name: 'salary', icon: 'üíº'},
                {name: 'freelance', icon: 'üíª'},
                {name: 'investment', icon: 'üìà'},
                {name: 'gift', icon: 'üéÅ'},
                {name: 'bonus', icon: 'üí∞'},
                {name: 'refund', icon: 'üíµ'},
                {name: 'other', icon: 'üí≥'}
            ],
            expense: [
                {name: 'food', icon: 'üçî'},
                {name: 'groceries', icon: 'üõí'},
                {name: 'transport', icon: 'üöó'},
                {name: 'utilities', icon: 'üí°'},
                {name: 'entertainment', icon: 'üé¨'},
                {name: 'shopping', icon: 'üõçÔ∏è'},
                {name: 'health', icon: 'üè•'},
                {name: 'education', icon: 'üéì'},
                {name: 'insurance', icon: 'üõ°Ô∏è'},
                {name: 'rent', icon: 'üè†'},
                {name: 'bills', icon: 'üìÑ'},
                {name: 'gym', icon: 'üèãÔ∏è'},
                {name: 'clothing', icon: 'üëï'},
                {name: 'beauty', icon: 'üíÑ'},
                {name: 'pets', icon: 'üêï'},
                {name: 'gifts', icon: 'üéÅ'},
                {name: 'travel', icon: '‚úàÔ∏è'},
                {name: 'dining', icon: 'üçΩÔ∏è'},
                {name: 'coffee', icon: '‚òï'},
                {name: 'subscriptions', icon: 'üì±'},
                {name: 'custom', icon: '‚ûï'},
                {name: 'other', icon: 'üì¶'}
            ],
            fuel: [
                {name: 'petrol', icon: '‚õΩ'},
                {name: 'diesel', icon: '‚õΩ'},
                {name: 'electric', icon: 'üîå'},
                {name: 'other', icon: 'üöó'}
            ]
        };
        
        const categoryColors = {
            salary: '#10b981', freelance: '#059669', investment: '#14b8a6', gift: '#06b6d4',
            food: '#f59e0b', transport: '#3b82f6', utilities: '#8b5cf6', entertainment: '#ec4899',
            shopping: '#f97316', health: '#ef4444', education: '#6366f1', petrol: '#dc2626',
            diesel: '#7c2d12', electric: '#65a30d', groceries: '#84cc16', insurance: '#0ea5e9',
            rent: '#8b5cf6', bills: '#f59e0b', gym: '#22c55e', clothing: '#ec4899',
            beauty: '#f472b6', pets: '#fb923c', gifts: '#a855f7', travel: '#06b6d4',
            dining: '#f97316', coffee: '#78350f', subscriptions: '#6366f1', bonus: '#10b981',
            refund: '#14b8a6', other: '#6b7280', custom: '#667eea'
        };
        
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let customCategories = JSON.parse(localStorage.getItem('customCategories')) || {};
        let currentFilter = 'all';
        let currentTimeFilter = 'all';
        let currentCurrency = localStorage.getItem('currency') || 'USD';
        let currencySymbol = '$';
        
        function init() {
            document.getElementById('date').valueAsDate = new Date();
            loadCurrency();
            renderIconSelector();
            updateCategories();
            updateStats();
            renderTransactions();
        }
        
        function loadCurrency() {
            const select = document.getElementById('currencySelect');
            select.value = currentCurrency;
            const option = select.options[select.selectedIndex];
            currencySymbol = option.dataset.symbol;
        }
        
        function changeCurrency() {
            const select = document.getElementById('currencySelect');
            currentCurrency = select.value;
            const option = select.options[select.selectedIndex];
            currencySymbol = option.dataset.symbol;
            localStorage.setItem('currency', currentCurrency);
            updateStats();
            renderTransactions();
        }
        
        function renderIconSelector() {
            const selector = document.getElementById('iconSelector');
            selector.innerHTML = availableIcons.map(icon => 
                `<div class="icon-option" onclick="selectIcon('${icon}')">${icon}</div>`
            ).join('');
        }
        
        function selectIcon(icon) {
            document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('selectedIcon').value = icon;
        }
        
        function updateCategories() {
            const type = document.getElementById('type').value;
            const categorySelect = document.getElementById('category');
            const fuelFields = document.getElementById('fuelFields');
            
            categorySelect.innerHTML = '';
            
            // Add default categories
            defaultCategories[type].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.icon + ' ' + cat.name.charAt(0).toUpperCase() + cat.name.slice(1);
                option.dataset.icon = cat.icon;
                categorySelect.appendChild(option);
            });
            
            // Add custom categories for this type
            if (customCategories[type]) {
                customCategories[type].forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.icon + ' ' + cat.name;
                    option.dataset.icon = cat.icon;
                    option.dataset.custom = 'true';
                    categorySelect.appendChild(option);
                });
            }
            
            fuelFields.style.display = type === 'fuel' ? 'grid' : 'none';
            checkCustomCategory();
        }
        
        function checkCustomCategory() {
            const category = document.getElementById('category').value;
            const customSection = document.getElementById('customCategorySection');
            customSection.classList.toggle('active', category === 'custom');
        }
        
        function toggleForm() {
            const form = document.getElementById('formContainer');
            form.classList.toggle('active');
            if (form.classList.contains('active')) {
                document.getElementById('customCategorySection').classList.remove('active');
            }
        }
        
        function addTransaction(e) {
            e.preventDefault();
            
            const type = document.getElementById('type').value;
            let category = document.getElementById('category').value;
            let categoryIcon = document.getElementById('category').selectedOptions[0].dataset.icon;
            
            // Handle custom category
            if (category === 'custom') {
                const customName = document.getElementById('customCategoryName').value.trim();
                const customIcon = document.getElementById('selectedIcon').value;
                
                if (!customName || !customIcon) {
                    alert('Please enter a category name and select an icon');
                    return;
                }
                
                category = customName.toLowerCase().replace(/\s+/g, '-');
                categoryIcon = customIcon;
                
                // Save custom category
                if (!customCategories[type]) {
                    customCategories[type] = [];
                }
                if (!customCategories[type].find(c => c.name === customName)) {
                    customCategories[type].push({name: customName, icon: customIcon});
                    localStorage.setItem('customCategories', JSON.stringify(customCategories));
                    categoryColors[category] = '#667eea';
                }
            }
            
            const transaction = {
                id: Date.now(),
                type: type,
                category: category,
                categoryIcon: categoryIcon,
                amount: parseFloat(document.getElementById('amount').value),
                date: document.getElementById('date').value,
                description: document.getElementById('description').value,
                notes: document.getElementById('notes').value,
                mileage: document.getElementById('mileage').value ? parseFloat(document.getElementById('mileage').value) : null,
                fuelAmount: document.getElementById('fuelAmount').value ? parseFloat(document.getElementById('fuelAmount').value) : null,
                currency: currentCurrency
            };
            
            transactions.unshift(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            document.getElementById('transactionForm').reset();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('customCategoryName').value = '';
            document.getElementById('selectedIcon').value = '';
            document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
            toggleForm();
            updateCategories();
            updateStats();
            renderTransactions();
        }
        
        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                updateStats();
                renderTransactions();
            }
        }
        
        function updateStats() {
            const filtered = getFilteredTransactions();
            const income = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = filtered.filter(t => t.type === 'expense' || t.type === 'fuel').reduce((sum, t) => sum + t.amount, 0);
            const fuel = filtered.filter(t => t.type === 'fuel').reduce((sum, t) => sum + t.amount, 0);
            const mileage = filtered.filter(t => t.mileage).reduce((sum, t) => sum + t.mileage, 0);
            const balance = income - expense;
            
            document.getElementById('totalIncome').textContent = currencySymbol + income.toFixed(2);
            document.getElementById('totalExpense').textContent = currencySymbol + expense.toFixed(2);
            document.getElementById('totalFuel').textContent = currencySymbol + fuel.toFixed(2);
            document.getElementById('totalMileage').textContent = mileage.toFixed(1) + ' mi';
            document.getElementById('balance').textContent = currencySymbol + balance.toFixed(2);
            
            const balanceCard = document.getElementById('balanceCard');
            if (balance < 0) {
                balanceCard.classList.add('negative');
            } else {
                balanceCard.classList.remove('negative');
            }
        }
        
        function filterByTime(period) {
            currentTimeFilter = period;
            
            document.querySelectorAll('.time-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateStats();
            renderTransactions();
        }
        
        function filterTransactions(filter) {
            currentFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderTransactions();
        }
        
        function getFilteredTransactions() {
            let filtered = transactions;
            
            // Time filter
            if (currentTimeFilter !== 'all') {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                filtered = filtered.filter(t => {
                    const transDate = new Date(t.date);
                    
                    switch(currentTimeFilter) {
                        case 'today':
                            return transDate >= today;
                        case 'yesterday':
                            const yesterday = new Date(today);
                            yesterday.setDate(yesterday.getDate() - 1);
                            return transDate >= yesterday && transDate < today;
                        case 'week':
                            const weekAgo = new Date(today);
                            weekAgo.setDate(weekAgo.getDate() - 7);
                            return transDate >= weekAgo;
                        case 'month':
                            return transDate.getMonth() === now.getMonth() && 
                                   transDate.getFullYear() === now.getFullYear();
                        case 'year':
                            return transDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            // Type filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(t => t.type === currentFilter);
            }
            
            return filtered;
        }
        
        function renderTransactions() {
            const container = document.getElementById('transactionsList');
            const filtered = getFilteredTransactions();
            
            document.getElementById('transactionCount').textContent = 
                `${filtered.length} transaction${filtered.length !== 1 ? 's' : ''}`;
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state">No transactions found for this filter.</div>';
                return;
            }
            
            container.innerHTML = filtered.map(t => `
                <div class="transaction ${t.type}-type">
                    <div class="transaction-info">
                        <h4>
                            <span class="transaction-icon">${t.categoryIcon}</span>
                            <span class="category-badge" style="background: ${categoryColors[t.category] || '#6b7280'}">${t.category}</span>
                            ${t.description || t.category}
                        </h4>
                        <div class="transaction-details">
                            <span>üìÖ ${t.date}</span>
                            ${t.mileage ? `<span>üõ£Ô∏è ${t.mileage} mi</span>` : ''}
                            ${t.fuelAmount ? `<span>‚õΩ ${t.fuelAmount} gal</span>` : ''}
                        </div>
                        ${t.notes ? `<div style="margin-top: 8px; color: #666; font-size: 0.9em;">üìù ${t.notes}</div>` : ''}
                    </div>
                    <div class="transaction-amount">
                        <div class="amount ${t.type === 'income' ? 'income' : 'expense'}">
                            ${t.type === 'income' ? '+' : '-'}${currencySymbol}${t.amount.toFixed(2)}
                        </div>
                        <button class="btn-delete" onclick="deleteTransaction(${t.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            menu.classList.toggle('active');
        }
        
        function exportCSV() {
            const filtered = getFilteredTransactions();
            if (filtered.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            const headers = ['Date', 'Type', 'Category', 'Description', 'Amount', 'Currency', 'Mileage', 'Fuel Amount', 'Notes'];
            const csv = [
                headers.join(','),
                ...filtered.map(t => [
                    t.date,
                    t.type,
                    t.category,
                    `"${t.description || ''}"`,
                    t.amount,
                    t.currency || currentCurrency,
                    t.mileage || '',
                    t.fuelAmount || '',
                    `"${t.notes || ''}"`
                ].join(','))
            ].join('\n');
            
            downloadFile(csv, `transactions_${currentTimeFilter}_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            toggleExportMenu();
        }
        
        function exportExcel() {
            const filtered = getFilteredTransactions();
            if (filtered.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            // Create HTML table
            const headers = ['Date', 'Type', 'Category', 'Description', 'Amount', 'Currency', 'Mileage', 'Fuel Amount', 'Notes'];
            const html = `
                <table>
                    <thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                    <tbody>
                        ${filtered.map(t => `
                            <tr>
                                <td>${t.date}</td>
                                <td>${t.type}</td>
                                <td>${t.category}</td>
                                <td>${t.description || ''}</td>
                                <td>${t.amount}</td>
                                <td>${t.currency || currentCurrency}</td>
                                <td>${t.mileage || ''}</td>
                                <td>${t.fuelAmount || ''}</td>
                                <td>${t.notes || ''}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            downloadFile(html, `transactions_${currentTimeFilter}_${new Date().toISOString().split('T')[0]}.xls`, 'application/vnd.ms-excel');
            toggleExportMenu();
        }
        
        function exportJSON() {
            const filtered = getFilteredTransactions();
            if (filtered.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            const json = JSON.stringify(filtered, null, 2);
            downloadFile(json, `transactions_${currentTimeFilter}_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            toggleExportMenu();
        }
        
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Close export menu when clicking outside
        document.addEventListener('click', function(event) {
            const exportDropdown = document.querySelector('.export-dropdown');
            if (exportDropdown && !exportDropdown.contains(event.target)) {
                document.getElementById('exportMenu').classList.remove('active');
            }
        });
        
        init();
    </script>
</body>
</html>